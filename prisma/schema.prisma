generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String                 @id @default(cuid())
  phoneNumber   String                 @unique
  name          String?
  email         String?
  avatar        String?
  bio           String?
  isVerified    Boolean                @default(false)
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  conversationParticipants ConversationParticipant[]
  messages      Message[]
  stores        Store[]
  orders        Order[]
  reviews       Review[]
  likedProducts LikedProduct[]
}

model Conversation {
  id            String                 @id @default(cuid())
  participants  ConversationParticipant[]
  messages      Message[]
  lastMessage   String?
  lastMessageAt DateTime?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
}

model ConversationParticipant {
  id              String        @id @default(cuid())
  conversationId  String
  userId          String
  conversation    Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt       DateTime      @default(now())

  @@unique([conversationId, userId])
}

model Message {
  id              String       @id @default(cuid())
  content         String
  type            String       @default("text")
  mediaUrl        String?
  senderId        String
  conversationId  String
  status          String       @default("sent")
  timestamp       DateTime     @default(now())
  sender          User         @relation(fields: [senderId], references: [id], onDelete: Cascade)
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model Store {
  id            String      @id @default(cuid())
  name          String
  description   String?
  logo          String?
  banner        String?
  ownerId       String
  owner         User        @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  products      Product[]
  orders        Order[]
  reviews       Review[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Product {
  id            String        @id @default(cuid())
  name          String
  description   String?
  price         Float
  imageUrl      String?
  category      String
  likes         Int           @default(0)
  storeId       String
  store         Store         @relation(fields: [storeId], references: [id], onDelete: Cascade)
  orders        OrderItem[]
  reviews       Review[]
  likedProducts LikedProduct[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Order {
  id            String      @id @default(cuid())
  userId        String
  storeId       String
  totalAmount   Float
  status        String      @default("pending")
  shippingInfo  String?
  paymentInfo   String?
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  store         Store       @relation(fields: [storeId], references: [id], onDelete: Cascade)
  items         OrderItem[]
  reviews       Review[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model OrderItem {
  id            String    @id @default(cuid())
  orderId       String
  productId     String
  quantity      Int
  price         Float
  order         Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())
}

model Review {
  id            String    @id @default(cuid())
  userId        String
  storeId       String?
  productId     String?
  orderId       String?
  rating        Int
  comment       String?
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  store         Store?    @relation(fields: [storeId], references: [id], onDelete: Cascade)
  product       Product?  @relation(fields: [productId], references: [id], onDelete: Cascade)
  order         Order?    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model LikedProduct {
  id            String    @id @default(cuid())
  userId        String
  productId     String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())

  @@unique([userId, productId])
}

model OTP {
  id            String    @id @default(cuid())
  phoneNumber   String
  otp           String
  expiresAt     DateTime
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([phoneNumber, otp])
}
